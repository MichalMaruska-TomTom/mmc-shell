#! /bin/bash -eu


# create a workspace, with the shared .git directory.
# Thus you can *consume* & still work with Git commands.
usage()
{
    echo "usage: ${0##*/} [+-h} [--] dir"
    echo
    echo "Creates dir/new which shares .git"
}

while getopts :h OPT; do
    case $OPT in
	h|+h)
	    usage
	    exit 0
	    ;;
	*)
	    usage
	    exit 2
    esac
done
shift $(( OPTIND - 1 ))
OPTIND=1


if [ $# -lt 1 ]; then
    usage
    exit 1
fi


dir=$1
new=$1/new

if test -e $new; then
    exit 1;
fi

mkdir -p $new
rsync --exclude .git  -rv  $dir/ $new/
# ln -s $dir/.git $new/.git
ln -s ../.git $new/.git

exit 0

cd $new
magit
