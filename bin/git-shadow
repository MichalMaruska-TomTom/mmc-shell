#! /bin/bash -eu


# create a workspace, with the shared .git directory.
# Thus you can *consume* & still work with Git commands.
usage()
{
    echo "usage: ${0##*/} [+-h} [--] ARGS..."
}

while getopts :h OPT; do
    case $OPT in
	h|+h)
	    usage
	    exit 0
	    ;;
	*)
	    usage
	    exit 2
    esac
done
shift $(( OPTIND - 1 ))
OPTIND=1

if [ $# -le 1 ]; then
    usage
    exit 1
fi

dir=$1
new=$(basename $(readlink -f $dir)).new

mkdir -p $new
rsync --exclude .git  -rv  $dir/ $new/
ln -s $dir/.git $new/.git

exit 0

cd $new
magit
