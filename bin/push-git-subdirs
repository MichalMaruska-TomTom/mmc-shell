#! /usr/bin/zsh -f

setopt extendedglob

gitoptions="--no-pager"
git=(git $gitoptions)


remote=origin

foreach dir (^build-area(/)) {
    cd $dir
    if [ -d .git ];
    then
	cecho blue "===" $dir "==="
	files=$(${git} ls-files -o)
#    echo $files
	if [ ! -z $files ]
	then
	    pwd
	    ls -l --color $files
	fi
	if ${git} status --short;
	then
	    git-since-last-tag

	    if git remote |grep $remote;
	    then
		cecho green -n "pushing to ";git remote show $remote|grep 'Push  URL'
		git push $remote
		git push $remote --tags
	    else
		cecho yellow $dir is not associated with any $remote
	    fi
	else
	    cecho red $dir is not clean!
	fi
    else
	cecho blue $dir  is not Git
    fi
    cd -
}