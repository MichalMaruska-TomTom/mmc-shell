#! /usr/bin/zsh -feu

# USAGE: $0 dir head

# In directory @dir, assumed git,
# checks-out @head, possibly rebasing it by `git-rebase-poset'



dir=$1
cecho hiyellow $dir
cd $dir

name=${2#refs/heads/}

# but is the base pre_fetch_head?
if git-segment $name &> /dev/null ;
then
    # why not *-poset ?
    git-rebase-poset $name
elif git-sum $name
then
    git-rebase-poset $name
fi


git checkout $name

# join -t ' ' -v 1 -1 1 -2 1   $1 $2 |\
# awk '/^(.*) (.*)$/  {system(sprintf("echo %s  %s", $1, $2));}'


# exists base ->
# git br -f base tt-server/ics-dev
# git-rebase-poset all

# repo_save_horizon > .now

# join -t ' ' -v 1 -1 1 -2 1   .pre.br .now  |\
# awk '/^(.*) (.*)$/  {system(sprintf("~/git-restate %s  %s", $1, $2));}'
