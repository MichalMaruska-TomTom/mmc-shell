#! /bin/zsh -feu

# In directory @dir, assumed git,
# checks-out @head, possibly rebasing it by `git-rebase-poset'

unsetopt FUNCTION_ARGZERO

usage()
{
    cat <<EOF
usage: ${0##*/} DIR HEAD
EOF
}


if [ $# -lt 2 ]; then
    usage
    exit 1
fi

dir=$1
GIT_REF=${2#refs/heads/}

cecho magenta "-- $dir"
cd $dir


# but is the base pre_fetch_head?
if git-segment $GIT_REF &> /dev/null ||
    git-sum $GIT_REF &> /dev/null
then
    git-rebase-poset $GIT_REF
    git checkout $GIT_REF
else
    git checkout $GIT_REF
fi
