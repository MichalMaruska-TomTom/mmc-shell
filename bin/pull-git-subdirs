#! /bin/zsh -f

# can be used:   for-each-git-dir --pass pull-git-subdirs


gitoptions="--no-pager"
git_cmd=(git $gitoptions)

do_pull()
{
    dir=$1
    remote=$2
    echo
    if ${git_cmd} status --short;
    then
        cecho green -n "pulling";
                #  from       ${git} remote show $remote|grep 'Fetch URL'
        ${git_cmd} pull --tags $remote master
                # ${git} fetch --tags $remote
    else
        cecho red $dir is not clean!
    fi
}


remote=origin
while getopts :r: OPT; do
    case $OPT in
        r|+r)
            remote="$OPTARG"
            ;;
        *)
            print "usage: ${0##*/} [+-r ARG} [--] ARGS..."
            exit 2
    esac
done
shift OPTIND-1
OPTIND=1


dir=$1
cecho blue -n "===" $dir "==="
if ${git} remote |grep $remote > /dev/null;
then
    do_pull $dir $remote
else
    cecho yellow "... is not associated with any $remote, trying origin"
    do_pull $dir origin
fi
}
