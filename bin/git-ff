#!/bin/zsh -feu

source /usr/share/mmc-shell/git-functions.sh

# set -x
usage() {
    setopt POSIX_ARGZERO
    cat <<EOF
usage: ${0##*/} [+-h] [--]  remote   branch

Fast-forward to remote head, stashing around.
EOF
    unsetopt POSIX_ARGZERO
}

set_remote_name
# todo: the same I'm on
branch=$(current_branch_name)

while getopts :h OPT; do
    case $OPT in
        h|+h)
            usage
            exit 0
            ;;
        *)
            usage >&2
            exit 2
    esac
done
shift OPTIND-1
OPTIND=1

if [ $# -gt 0 ]; then
    GIT_REMOTE_NAME=$1
    shift
fi

if [ $# -gt 0 ]; then
    branch=$1
    shift
fi

# fixme: if necessary:
stash_if_non_clean

# git checkout $branch
git merge --ff-only $remote/$branch

unstash_if_stashed
