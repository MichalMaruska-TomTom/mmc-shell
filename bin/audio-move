#!/bin/zsh -feu

set -x
sink_number()
{
    pactl list short sinks|grep -e $1 | cut -f 1
}

usage()
{
    cat <<EOF
usage: ${0##*/} [+-pbsh} [--] ARGS...
-b builtin

-p  phones
-s speakers

EOF
}


move_to()
{
    sink=$1
    sink_input=$(pactl list short sink-inputs|cut -f 1)
    pactl set-default-sink $sink
    pactl move-sink-input $sink_input $sink
}

while getopts :pbsh OPT; do
    case $OPT in
        p|+p)
            headphones=$(sink_number 'USB.*Dock_0')
            move_to $headphones
            ;;
        b|+b)
            builtin=$(sink_number "alsa_output.pci-0000_00_1f.3.analog-stereo")
            move_to $builtin
            ;;
        s|+s)
            speakers=$(sink_number 'USB.*Dock_1')
            move_to $speakers
            ;;
        h|+h)
            usage
            exit 0
            ;;
        *)
            usage >&2
            exit 2
    esac
done
shift OPTIND-1
OPTIND=1


