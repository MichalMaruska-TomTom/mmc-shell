#! /bin/bash -uex

# invoke repo sync, and then restore the checked-out branches.
# It's assumed they know how to rebase. ( git-rebase-* cmds)


# taken from gen_platform_zip:
{
    repo forall -c 'echo $REPO_PATH `git log --format="format:%H" --max-count=1`' > git-heads.txt &
    pid1=$tmpses
    repo_save_horizon > horizon.pre &
    pid2=$tmpses

    wait $pid1 $pid2
}

cat horizon.pre

#cecho red "press enter ==>"
# read a
# This can fail
repo sync || :

repo_save_horizon > horizon.post

repo_restore_horizon  horizon.pre horizon.post

repo_save_horizon > horizon.restored

repo_restore_horizon horizon.pre horizon.restored
